/* === UI Recovery CSS (merged) === */

:root {
  --bg: #fff;
  --text: #111827;
  --muted: #6b7280;
  --border: #e5e7eb;
  --card: #f9fafb;
  --brand: #111111;
  --brand-2: #1f2937;
  --accent: #111111;
  --radius: 14px;
  --shadow: 0 8px 24px rgba(0,0,0,0.06);
}

body { background: var(--bg); color: var(--text); }

.page-wrap { max-width: 1060px; margin: 36px auto 72px; padding: 0 18px; }

.title { font-size: 30px; font-weight: 800; }
.subtitle { font-size: 18px; font-weight: 700; margin-bottom: 10px; }

.card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 20px 22px;
  margin: 18px 0;
}

.header-row { display:flex; align-items:center; justify-content:space-between; gap:12px; }

/* --- Forms --- */
.form { display:grid; gap:12px; }
.label { font-weight:700; }
.input {
  width: 100%; padding: 11px 13px;
  border:1px solid var(--border); border-radius: 10px;
  outline:none; background:#fff;
}
input[type="date"].input { padding: 9px 11px; }

/* Buttons */
.btn {
  display:inline-flex; align-items:center; justify-content:center; gap:8px;
  padding: 9px 14px; border-radius: 999px;
  background: var(--accent); color: #fff;
  font-weight: 700; font-size: 14px;
  border: 1px solid var(--brand-2); text-decoration:none;
  transition: transform .06s ease, box-shadow .12s ease;
}
.btn:hover { transform: translateY(-1px); }
.btn.ghost { background:#fff; color: var(--text); border:1px solid var(--border); box-shadow:none; }
.btn.small { padding: 6px 10px; font-size: 13px; white-space:nowrap; }

/* --- Table --- */
.table-card { padding-top: 8px; }
.table-head { display:flex; align-items:center; justify-content:space-between; margin: 8px 0 6px; color: var(--muted); }
.table-wrap { overflow:auto; border-radius: 12px; border:1px solid var(--border); background:#fff; }
.nice-table { width:100%; border-collapse: separate; border-spacing: 0; font-size: 14.5px; }
.nice-table thead th {
  text-align:left; font-weight:800; padding: 12px 14px; background:#f3f4f6; border-bottom:1px solid var(--border);
  position: relative; top: auto; z-index:1;
}
.nice-table tbody td { padding: 12px 14px; border-top:1px solid var(--border); vertical-align: middle; }
.nice-table tbody tr:nth-child(even){ background:#fafafa; }
.nice-table td.nowrap, .nice-table th.nowrap { white-space: nowrap; }
.nice-table td.reason { max-width: 260px; }
.nice-table td.name { max-width: 220px; }
.nice-table td.class { white-space: nowrap; }
.nice-table td.action { width: 96px; text-align: right; }

/* --- Flash --- */
.flash-stack { display:grid; gap:10px; margin-bottom: 10px; }
.flash { border-radius: 10px; padding: 11px 13px; border:1px solid var(--border); background: #fff; font-size: 14px; }
.flash.success { border-color:#16a34a33; background:#16a34a0d; }
.flash.error   { border-color:#dc262633; background:#dc26260d; }
.flash.info    { border-color:#2563eb33; background:#2563eb0d; }

/* --- Pager / Nav --- */
.pager { display:flex; gap:12px; align-items:center; margin-top:14px; }
.spacer { flex:1; }
.nav-links { display:flex; justify-content:space-between; margin-top: 16px; }
.link { color: #111; text-decoration: none; font-weight: 700; }
.link:hover { text-decoration: underline; }

/* --- Classroom pagination (match log/result buttons) --- */
.pagination { display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin-top:14px; }
.page-link {
  display:inline-flex; align-items:center; justify-content:center;
  padding: 6px 10px;
  border-radius: 999px;
  background:#fff;
  color: var(--text);
  border:1px solid var(--border);
  text-decoration:none;
  font-weight: 700;
  font-size: 13px;
  white-space: nowrap;
}
.page-link:hover { transform: translateY(-1px); }
.page-link.active {
  background: var(--accent);
  color:#fff;
  border-color: var(--brand-2);
}

/* --- Student (result.php) --- */
.student-grid { display:grid; grid-template-columns: 160px 1fr; gap: 8px 16px; }
.student-grid .row { display: contents; }
.k { color: var(--muted); font-weight:600; }
.v { font-weight:600; }
.v.score { font-size: 21px; }

/* --- Fixed width toolbar for log.php --- */
.toolbar-fw { display:flex; align-items:flex-end; justify-content:space-between; gap:20px; }
.filters-fw { display:flex; flex-wrap:wrap; gap:14px 18px; align-items:flex-end; }
.filters-fw .field { display:flex; flex-direction:column; gap:6px; width:auto; min-width:0; }
.filters-fw .input { box-sizing:border-box; max-width:100%; border-radius:12px; }
.filters-fw .input.short{ width:220px !important; }
.filters-fw .input.date{  width:200px !important; }
.filters-fw .input.tiny{  width:110px !important; }
.filters-actions { display:flex; gap:10px; align-items:center; justify-content:flex-end; }
.filters-actions .btn{ white-space:nowrap; }

/* --- Responsive --- */
@media (max-width: 980px){
  .toolbar-fw{ flex-direction:column; align-items:stretch; }
  .filters-actions{ justify-content:flex-start; flex-wrap:wrap; }
  .filters-fw .input.short, .filters-fw .input.date, .filters-fw .input.tiny{ width:100% !important; }
}
@media (max-width: 560px) {
  .student-grid { grid-template-columns: 1fr; }
}


/* === Score adjust modal + segmented === */
.segmented{
  display:flex;
  gap:10px;
  padding:8px;
  border-radius:14px;
  background: rgba(0,0,0,.06);
  width: fit-content;
  margin-bottom: 14px;
}
.seg-btn{
  border:0;
  background: transparent;
  padding:10px 14px;
  border-radius:12px;
  cursor:pointer;
  font-weight:600;
}
.seg-btn.is-active{
  background:#fff;
  box-shadow: 0 6px 18px rgba(0,0,0,.10);
}
.picker-row{
  display:flex;
  gap:10px;
  align-items:center;
}
.picker-row .input{ flex: 1; }

/* Keep the readonly display tidy (long reasons) */
#reasonDisplay{
  white-space: nowrap;
  overflow: visible;
  text-overflow: ellipsis;
}

/* Selected reason preview (helps on mobile where the input may be tight) */
.chosen-reason{
  margin-top: 10px;
  padding: 10px 12px;
  border-radius: 14px;
  background: rgba(0,0,0,.05);
  line-height: 1.35;
  word-break: break-word;
}

/* Multi-selected reasons chips (on the page) */
.chosen-reason .chips{
  display:flex;
  flex-wrap: wrap;
  gap: 8px;
}

/* Default: keep the preview compact. JS toggles .is-expanded when user opens “+N more”. */
.chosen-reason.is-collapsed .chips{
  flex-wrap: nowrap;
  overflow-x: auto;
  overflow-y: hidden;
  padding-bottom: 2px;
}
.chosen-reason.is-collapsed .chip{ flex: 0 0 auto; max-width: 280px; }
.chosen-reason.is-collapsed .chip-sub{
  max-width: 140px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.chosen-reason .chip{
  display:inline-flex;
  align-items:center;
  gap: 8px;
  padding: 6px 10px;
  border-radius: 999px;
  background: #fff;
  border: 1px solid rgba(0,0,0,.10);
  box-shadow: 0 6px 16px rgba(0,0,0,.06);
  font-weight: 800;
  font-size: 13px;
  max-width: 100%;
}
.chosen-reason .chip.chip-more{
  cursor: pointer;
  background: rgba(0,0,0,.07);
  border-style: dashed;
}
.chosen-reason .chip-sub{
  font-weight: 700;
  opacity: .85;
}
.chosen-reason .chip-pts{
  font-weight: 900;
  opacity: .85;
}
.chosen-reason .meta{
  margin-top: 10px;
  font-size: 13px;
  opacity: .70;
}

.btn.ghost{
  background: rgba(0,0,0,.06);
  color: inherit;
}

.modal{
  position: fixed;
  inset: 0;
  display:none;
  /* Desktop: sit above everything */
  z-index: 20000;
}
.modal.is-open{ display:block; }

.modal-backdrop{
  position:absolute;
  inset:0;
  background: rgba(0,0,0,.40);
  opacity:0;
  animation: modalFade .18s ease forwards;
}

.modal-panel{
  position: absolute;
  left: 50%;
  top: 12%;
  transform: translateX(-50%) translateY(-10px);
  width: min(720px, calc(100vw - 28px));
  max-height: 78vh;
  background: linear-gradient(#ffffff, #fbfbfc);
  border: 1px solid rgba(0,0,0,.08);
  border-radius: 18px;
  box-shadow: 0 18px 60px rgba(0,0,0,.30);
  overflow: hidden;
  opacity: 0;
  animation: modalDrop .22s ease forwards;
  display:flex;
  flex-direction: column;
}

/* Ensure scroll areas behave inside a flex modal (prevents list getting blocked) */
.modal-list{
  flex: 1 1 auto;
  min-height: 0; /* critical so overflow:auto can actually scroll in flex */
}

@keyframes modalFade{
  to { opacity: 1; }
}
@keyframes modalDrop{
  to { opacity: 1; transform: translateX(-50%) translateY(0); }
}

.modal-head{
  display:flex;
  align-items:center;
  justify-content: space-between;
  gap: 12px;
  padding: 16px 18px;
  background: linear-gradient(180deg, #ffffff 0%, #f4f5f7 100%);
  border-bottom: 1px solid rgba(0,0,0,.08);
  /* This sits above the scrollable list; don't let flexbox shrink it on tiny screens */
  flex: 0 0 auto;
  flex-shrink: 0;
}
.modal-title{ display:flex; flex-direction:column; gap:2px; }
.modal-title-row{ display:flex; align-items:center; gap:10px; }
.modal-badge{
  width: 32px;
  height: 32px;
  border-radius: 12px;
  display:grid;
  place-items:center;
  background: rgba(0,0,0,.08);
  font-weight: 900;
  font-size: 18px;
  line-height: 1;
}
.modal-head h3{
  margin: 0;
  font-size: 18px;
  font-weight: 800;
}
.modal-sub{ font-size: 13px; opacity: .65; }
.icon-btn{
  width: 38px;
  height: 38px;
  border-radius: 12px;
  border: 0;
  background: rgba(0,0,0,.06);
  cursor:pointer;
  font-size: 20px;
  line-height: 1;
  display:grid;
  place-items:center;
}
.icon-btn:hover{ background: rgba(0,0,0,.10); }
.icon-btn:active{ transform: translateY(1px); }

/* Search bar (inside a pill wrapper) */
.modal-search-wrap{
  flex: 0 0 auto;
  flex-shrink: 0;
  margin: 12px 16px 10px;
  display:flex;
  align-items:center;
  gap:10px;
  padding: 10px 12px;
  border-radius: 16px;
  background: rgba(0,0,0,.04);
  border: 1px solid rgba(0,0,0,.07);
}
.modal-search-wrap:focus-within{
  background: rgba(0,0,0,.02);
  border-color: rgba(0,0,0,.20);
  box-shadow: 0 0 0 4px rgba(0,0,0,.06);
}
.search-ico{ opacity: .65; }

.modal-search{
  margin: 0;
  width: 100%;
  border: 0 !important;
  background: transparent !important;
  box-shadow: none !important;
  padding: 0 !important;
}

/* Selected summary inside modal */
.modal-selected{
  flex: 0 0 auto;
  flex-shrink: 0;
  min-height: 54px;
  margin: 2px 16px 10px;
  padding: 10px 12px;
  border-radius: 16px;
  border: 1px solid rgba(0,0,0,.08);
  background: rgba(255,255,255,.82);
  box-shadow: 0 10px 24px rgba(0,0,0,.10);
}
.modal-selected-row{
  display:flex;
  align-items:center;
  justify-content: space-between;
  gap: 12px;
}
.modal-selected-left{
  display:flex;
  align-items:center;
  gap: 10px;
  min-width: 0;
}
.modal-selected-meta{
  font-weight: 800;
  font-size: 13px;
  opacity: .75;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.selected-toggle{ display: none; }
.modal-selected.is-collapsed .modal-selected-chips{ display: none; }
.modal-selected.is-collapsed #clearSelected{ display: none; }
.modal-selected-actions{
  display:flex;
  gap: 10px;
  flex-wrap: wrap;
}
.modal-selected-chips{
  margin-top: 10px;
  display:flex;
  flex-wrap: wrap;
  gap: 8px;
  min-height: 44px;
  /* prevent the modal from being taken over when a ton of reasons are selected */
  max-height: 160px;
  overflow: auto;
  overscroll-behavior: contain;
}

/* Collapsed (default) view: keep it compact + one line */
.modal-selected:not(.is-expanded) .modal-selected-chips{
  flex-wrap: nowrap;
  overflow-x: auto;
  overflow-y: visible;
  max-height: none;
  padding-bottom: 2px;
}
.modal-selected:not(.is-expanded) .mchip{
  flex: 0 0 auto;
  max-width: 260px;
}
.modal-selected:not(.is-expanded) .mchip-desc{
  max-width: 140px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.modal-selected-chips::-webkit-scrollbar{ height: 10px; width: 10px; }
.modal-selected-chips::-webkit-scrollbar-thumb{ background: rgba(0,0,0,.16); border-radius: 999px; }
.modal-selected-chips::-webkit-scrollbar-track{ background: rgba(0,0,0,.04); border-radius: 999px; }

/* Override global mobile button styles inside the modal (mobile.css makes all buttons tall) */
.modal .mchip{
  min-height: 30px;
  padding: 6px 10px;
  font-size: 13px;
}
.modal .mchip-x{
  min-height: 0;
  padding: 0;
}
.modal .icon-btn{
  min-height: 0;
  padding: 0;
}

.mchip{
  border: 0;
  cursor: pointer;
  display:inline-flex;
  align-items:center;
  gap: 8px;
  padding: 8px 10px;
  border-radius: 999px;
  background: rgba(0,0,0,.05);
  transition: background .12s ease, transform .12s ease;
}
.mchip:hover{ background: rgba(0,0,0,.08); transform: translateY(-1px); }
.mchip:active{ transform: translateY(0); }
.mchip-code{ font-weight: 900; }
.mchip-desc{ opacity: .80; font-weight: 700; min-width: 0; }
.mchip-pts{ font-weight: 900; opacity: .80; }
.mchip-x{ opacity: .65; font-weight: 900; }

.mchip-more{
  background: rgba(0,0,0,.08);
  font-weight: 900;
}
.mchip-more:hover{ background: rgba(0,0,0,.12); }
.mchip-more:active{ transform: translateY(0); }

/* Expanded selected chips area gets a bit more room, but stays scrollable */
.modal-selected.is-expanded .modal-selected-chips{
  max-height: 260px;
}
@media (max-width: 520px){
  .modal-selected.is-expanded .modal-selected-chips{
    max-height: 34vh;
  }
}

.modal-list{
  padding: 12px 12px 14px;
  overflow:auto;
  background: rgba(0,0,0,.02);
}
.modal-list::-webkit-scrollbar{ width: 10px; }
.modal-list::-webkit-scrollbar-thumb{ background: rgba(0,0,0,.18); border-radius: 999px; }
.modal-list::-webkit-scrollbar-track{ background: rgba(0,0,0,.04); border-radius: 999px; }

.reason-item{
  width: 100%;
  display:grid;
  grid-template-columns: 100px 1fr 70px;
  gap: 10px;
  align-items:center;
  text-align:left;
  position: relative;
  border:0;
  background: #fff;
  border: 1px solid rgba(0,0,0,.08);
  padding: 12px 44px 12px 12px; /* reserve space for selected check */
  border-radius: 14px;
  cursor:pointer;
  transition: transform .12s ease, box-shadow .12s ease, background .12s ease, border-color .12s ease;
}
.reason-item:hover{
  background: rgba(0,0,0,.02);
  box-shadow: 0 10px 22px rgba(0,0,0,.10);
  transform: translateY(-1px);
}
.reason-item:focus{ outline: none; }
.reason-item:focus-visible{ box-shadow: 0 0 0 4px rgba(0,0,0,.12); }
.reason-item.is-selected{
  background: rgba(0,0,0,.03);
  border-color: rgba(0,0,0,.22);
  box-shadow: 0 12px 26px rgba(0,0,0,.12);
}
.reason-item.is-selected::after{
  content: "✓";
  position: absolute;
  right: 12px;
  top: 12px;
  width: 24px;
  height: 24px;
  border-radius: 999px;
  background: rgba(0,0,0,.08);
  display:grid;
  place-items:center;
  font-weight: 900;
  font-size: 14px;
}
.reason-item + .reason-item{
  margin-top: 8px;
}
.reason-code{
  font-weight: 900;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width: fit-content;
  padding: 6px 10px;
  border-radius: 999px;
  background: rgba(0,0,0,.06);
}
.reason-desc{
  opacity: .95;
  line-height: 1.25;
}
.reason-pts{
  font-weight: 900;
  text-align:right;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding: 6px 10px;
  border-radius: 999px;
  background: rgba(0,0,0,.06);
  width: fit-content;
  justify-self: end;
}
.reason-item.other .reason-pts{ opacity:.55; }

.modal-foot{
  flex: 0 0 auto;
  flex-shrink: 0;
  padding: 12px 16px 16px;
  border-top: 1px solid rgba(0,0,0,.08);
  background: linear-gradient(180deg, rgba(0,0,0,.02) 0%, rgba(0,0,0,.04) 100%);
}
.modal-foot-actions{
  margin-top: 10px;
  display:flex;
  gap: 10px;
  justify-content:flex-end;
}

/* Mobile/tablet sizing: some environments can render a "phone" viewport wider than expected,
   which makes a strict 520px breakpoint miss and the modal appears tiny.
   Use a safer breakpoint + !important overrides so it always becomes a usable sheet. */
@media (max-width: 900px){
  /* On mobile, keep the navbar visible (modal starts below it) */
  .modal{
    inset: 70px 0 0 0; /* navbar height */
    z-index: 9000; /* below navbar (z-index: 10000) */
  }
  /* Make the picker less cramped */
  .picker-row{ flex-direction: column; align-items: stretch; }
  .picker-row .btn{ width: 100%; }

  /* Mobile: make the modal a near-fullscreen sheet (more usable space) */
  .modal-panel{
    left: 12px !important;
    right: 12px !important;
    top: 12px !important;
    bottom: 12px !important;
    transform: none !important;
    width: auto !important;
    max-height: none !important;
    height: auto !important;
    width: auto !important;
    max-height: none !important;
    transform: translate3d(0, 10px, 0) !important;
    border-radius: 16px;
    animation: modalDropMobile .22s ease forwards;
  }

  /* Sticky header + search to keep things usable on small screens */
  .modal-head{
    position: relative;
    top: 0;
    background: linear-gradient(180deg, #ffffff 0%, #f4f5f7 100%);
    z-index: 2;
    box-shadow: 0 10px 22px rgba(0,0,0,.10);
    padding: 12px 14px;
  }
  .modal-search{
    position: relative;
    top: auto;
    z-index: 2;
    background: #fff;
    margin: 0;
  }
  .modal-search-wrap{
    position: relative;
    top: auto;
    z-index: 2;
    margin: 8px 10px 8px;
    padding: 8px 10px;
    border-radius: 14px;
  }

  .modal-selected{
    position: relative;
    top: auto; /* below head + search */
    z-index: 2;
    margin: 0 10px 8px;
    /* when many reasons are selected, don't let the chips block the whole modal */
    max-height: none;
    overflow: visible;
  }

  /* Collapse selected reasons to a single-line summary on mobile */
  .selected-toggle{ display: inline-flex; padding: 8px 10px; }
  .modal-selected-row{ flex-wrap: nowrap; align-items: center; }
  .modal-selected-actions{ flex-wrap: nowrap; gap: 8px; }
  .modal-selected-actions .btn{ padding: 8px 10px; font-size: 13px; }

  .modal-selected-chips{
    max-height: 120px;
    overflow: auto;
    padding-bottom: 2px;
    overscroll-behavior: contain;
  }

  .modal-selected-chips::-webkit-scrollbar{ height: 10px; width: 10px; }
  .modal-selected-chips::-webkit-scrollbar-thumb{ background: rgba(0,0,0,.16); border-radius: 999px; }
  .modal-selected-chips::-webkit-scrollbar-track{ background: rgba(0,0,0,.04); border-radius: 999px; }

  /* When expanded, let the action buttons wrap if needed */
  .modal-selected:not(.is-collapsed) .modal-selected-row{ align-items: flex-start; }
  .modal-selected:not(.is-collapsed) .modal-selected-actions{ width: 100%; justify-content: flex-end; flex-wrap: wrap; }
  .modal-selected:not(.is-collapsed) .modal-selected-actions .btn{ padding: 10px 12px; }
  .modal-list{ padding: 0 8px 12px; }

  .reason-item{ grid-template-columns: 64px 1fr 56px; padding: 12px 12px; }
  .reason-code{ font-size: 14px; }
  .reason-desc{ font-size: 14px; }
  .reason-pts{ font-size: 14px; }

  @keyframes modalDropMobile{
    to { opacity: 1; transform: translateY(0); }
  }
}


/* ===== v20: Mobile polish for selected reasons (chips) ===== */
@media (max-width: 900px){
  /* The +N chip already expands/collapses the list — hide the extra “ดูรายการ” toggle to save space */
  .modal .selected-toggle{ display:none !important; }

  .modal-selected{
    margin: 0 10px 10px !important;
    padding: 8px 10px !important;
    border-radius: 14px !important;
    box-shadow: 0 8px 18px rgba(0,0,0,.08) !important;
  }

  .modal-selected-row{
    gap: 10px !important;
    align-items: center !important;
  }

  /* Let the meta take 2 lines if needed (prevents ugly clipping) */
  .modal-selected-meta{
    font-size: 12px !important;
    font-weight: 800 !important;
    opacity: .72 !important;
    white-space: normal !important;
    overflow: visible !important;
    text-overflow: clip !important;
    line-height: 1.2 !important;
    max-width: 100% !important;
  }

  /* Action buttons: compact, not giant (override mobile.css global button sizing) */
  .modal .modal-selected-actions .btn,
  .modal .modal-selected-actions button{
    min-height: 32px !important;
    padding: 6px 10px !important;
    font-size: 12px !important;
    border-radius: 999px !important;
  }
  .modal #doneSelected{ padding: 6px 12px !important; }

  /* Chips area: clean “tray” + horizontal in collapsed mode */
  .modal-selected-chips{
    margin-top: 8px !important;
    padding: 6px !important;
    border-radius: 12px !important;
    background: rgba(0,0,0,.035) !important;
    border: 1px solid rgba(0,0,0,.06) !important;
    max-height: none !important;
  }

  .modal-selected:not(.is-expanded) .modal-selected-chips{
    flex-wrap: nowrap !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    -webkit-overflow-scrolling: touch;
  }

  /* Modal chips: override mobile.css global button sizing so they don’t become huge */
  .modal .mchip{
    min-height: 30px !important;
    padding: 6px 10px !important;
    font-size: 12px !important;
    border-radius: 999px !important;
    box-shadow: none !important;
    border: 1px solid rgba(0,0,0,.10) !important;
    background: rgba(255,255,255,.90) !important;
    gap: 6px !important;
  }
  .modal .mchip-code{ font-size: 12px !important; }
  .modal .mchip-desc{
    font-size: 12px !important;
    max-width: 140px !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
  }
  .modal .mchip-pts{ font-size: 12px !important; }

  .modal .mchip-x{
    font-size: 14px !important;
    margin-left: 6px !important;
  }

  .modal .mchip-more{
    background: rgba(0,0,0,.06) !important;
    border-style: dashed !important;
    font-weight: 900 !important;
  }

  /* Also keep the on-page chosen chips compact on mobile */
  .chosen-reason .chip{
    min-height: 30px !important;
    padding: 6px 10px !important;
    font-size: 12px !important;
  }
  .chosen-reason .chips{ gap: 6px !important; }
}

